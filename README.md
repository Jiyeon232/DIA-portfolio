# DIA (Do It Anything)
원데이 클래스 예약 플랫폼

---

## 📌 프로젝트 소개
DIA는 공방과 사용자를 연결하는 원데이 클래스 예약 플랫폼입니다.  
사용자 / 공방주 / 관리자 역할로 구성되어 있으며,  
클래스 조회부터 예약, 결제, 운영 관리까지 하나의 흐름으로 제공하는 서비스입니다.

---

## 📆 프로젝트 정보
- 진행 기간: 2025.10.31 ~ 2025.12.23
- 프로젝트 형태: 팀 프로젝트
- 담당 역할: 기능 단위로 화면부터 서버 로직까지 구현

---

## 🛠 기술 스택
- Backend: Java 21, Spring Boot 3.x
- ORM / Mapper: MyBatis
- Database: MySQL
- Frontend: React
- Tools: GitHub, IntelliJ

---

## 🙋 담당 기능
본 프로젝트에서 아래 기능을 중심으로 설계 및 구현을 담당했습니다.

- 예약·결제 트랜잭션 처리
- 일정 자동 업데이트 스케줄러 구현
- 관리자 공방/프로그램 승인 처리
- 승인 결과 알림 및 액션 로그 기록

---

## ⭐ 핵심 구현 기능

### 1. 예약·결제 처리
- 결제 성공 시 예약 상태를 확정으로 변경하고, 스케줄 인원을 증가 처리
- 결제 실패 또는 중복 요청 시 예약 상태 및 인원 변경이 발생하지 않도록 분기 처리
- 예약 상태 변경, 결제 처리, 인원 증감을 하나의 트랜잭션으로 관리하여 데이터 정합성 유지

---

### 2. 일정 자동 업데이트 기능
- Spring Scheduler를 활용하여 일정 상태를 주기적으로 점검
- 일정 시작 시간이 경과했거나 정원이 가득 찬 경우 자동으로 마감 처리
- 예약 취소로 인해 정원이 다시 확보되면 시작 시간 이전 조건에서 모집 상태로 재전환
- 마감된 일정은 예약 화면에서 선택 불가 처리하여 사용자 오류 방지

---

### 3. 관리자 공방/프로그램 승인 처리
- 관리자가 공방 및 프로그램 신청 내역을 승인 또는 거절할 수 있도록 구성
- 승인/거절 처리 시 즉시 상태 변경
- 승인 결과에 따라 공방주에게 알림 전송
- 승인 이력 추적을 위해 액션 로그에 처리 내역 저장

---

## 🧩 문제 해결 경험

### Deadlock 이슈 해결
- 일정 자동 갱신 스케줄러 실행 중, 예약 테이블과 일정 테이블 간 락 충돌로 Deadlock 발생
- 조회와 다중 업데이트 로직이 하나의 트랜잭션에서 수행되며 락 획득 순서가 불안정했던 것이 원인
- 조회 로직과 상태 변경 로직을 분리하여, 스케줄러에서는 상태 변경 대상 ID만 선별하도록 구조 개선
- 이를 통해 락 획득 순서를 고정하고 Deadlock 문제를 해결

---
